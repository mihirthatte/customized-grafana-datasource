{"version":3,"sources":["../src/query_ctrl.js"],"names":["QueryCtrl","GenericDatasourceQueryCtrl","$scope","$injector","uiSegmentSrv","scope","target","series","type","condition","groupby_field","metric_array","metricValues_array","aggregator","target_alias","whereClauseGroup","inlineGroupOperator","outerGroupOperator","percentileValue","bucket","bucketValue","test","index","parentIndex","hoverEdit","hiddenIndex","self","push","console","log","splice","a","datasource","findOperator","length","metricFindColumns","then","transformToSegments","metricFindValues","metricFindTables","arguments","findWhereFields","wName","rawQuery","panelCtrl","refresh","templateUrl"],"mappings":"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","file":"query_ctrl.js","sourcesContent":["import {QueryCtrl} from 'app/plugins/sdk';\nimport './css/query-editor.css!'\n\nexport class GenericDatasourceQueryCtrl extends QueryCtrl {\n\n  constructor($scope, $injector, uiSegmentSrv)  {\n    super($scope, $injector);\n\n    this.scope = $scope;\n    this.uiSegmentSrv = uiSegmentSrv;\n    this.target.series = this.target.series||'select table';\n    this.target.type = this.target.type || 'timeserie';\n    this.target.condition = this.target.condition||[];\n    this.target.groupby_field = this.target.groupby_field || ' '; \n    //this.target.segments = this.target.segments||[];\n    //this.target.valueSegments =this.target.valueSegments||[];\n    this.target.metric_array = this.target.metric_array||['Select Metric'];\n    this.target.metricValues_array = this.target.metricValues_array ||['Select Metric Value'];\n    this.target.aggregator = this.target.aggregator ||['average'];\n    this.target.target_alias = this.target.target_alias||\"\";\n    this.target.whereClauseGroup = this.target.whereClauseGroup||[[{'left':'Select Metric','op':'','right':''}]];\n    this.target.inlineGroupOperator = this.target.inlineGroupOperator||[['']];\n    this.target.outerGroupOperator = this.target.outerGroupOperator || [''];\n    this.target.percentileValue = this.target.percentileValue||[''];\n    this.target.bucket = this.target.bucket||[];\n    this.target.bucketValue = this.target.bucketValue||[];\n    this.test =\"\";\n    this.index=\"\";\n    this.parentIndex=\"\";\n    this.hoverEdit = false;\n    this.hiddenIndex = \"\";\n    self = this;\n  }\n\n  addWhereClause(index){\n\t\tthis.target.whereClauseGroup[index].push({'left':'Select Metric','op':'=','right':''});\n                console.log(this.target.metricValues_array);\n  \t}\n removeWhereClause(parentIndex,index){\n\t\tconsole.log(this.target.whereClauseGroup[parentIndex][index]);\n\t\tthis.target.whereClauseGroup[parentIndex].splice(index,1);\n\t\tconsole.log(this.target.whereClauseGroup[parentIndex]);\n\n\t}\n\n  addWhereClauseGroup(){\n                this.target.whereClauseGroup.push([{'left':'Select Metric','op':'','right':''}]);\n\t\tthis.target.inlineGroupOperator.push(['']);\n                console.log(this.target.metricValues_array);\n        }\n\n    getOperator(){              \n       var a = this.datasource.findOperator();\n\treturn a;\n\t//.then(this.uiSegmentSrv.transformToSegments(false));\n\t\n\t}\t\n  addSegments(){\n\t\tthis.target.metric_array.push('Select Metric');\n\t\tconsole.log(this.target.metric_array);\n\t}\n\n removeSegment(index){\n\t\tif(this.target.metric_array.length == 1){\n                        this.target.metric_array.splice(index,1,'Select Metric');\n                }\n\t\telse{\n\t\t\tthis.target.metric_array.splice(index,1);\n\t\t}\n\t\tconsole.log(\"I am in remove seg\");\n\t}\n\n  addValueSegments(){\n                this.target.metricValues_array.push('Select Metric Value');\n\t\tthis.target.aggregator.push('average');\n\t\tthis.target.percentileValue.push('');\n                console.log(this.target.metricValues_array);\n        } \n\n removeValueSegment(index){\n\t\tif(this.target.metricValues_array.length == 1){\n\t\t\tthis.target.metricValues_array.splice(index,1,'Select Metric Value');\n\t\t}\n\t\telse{ \n\t\t\tthis.target.metricValues_array.splice(index,1);\n\t\t}\n\t\tconsole.log(\"I am in remove value seg\");\n\n\t}\n\n addBucket(index){\n\t\tthis.target.bucket.splice(index,0,'bucket');\n\t\tthis.target.bucketValue.splice(index,0,'');\n\t\tconsole.log(this.target.bucket);\n\t}\n\n  getColumns() {\n\tconsole.log(\"I am in get Columns\");\n\tconsole.log(this.target);\n    return this.datasource.metricFindColumns(this.target)\n      .then(this.uiSegmentSrv.transformToSegments(false));\n  }\n\n  getMetricValues() {\n        console.log(\"I am in get Metric Values\");\n        console.log(this.target);\n    \treturn this.datasource.metricFindValues(this.target);\n      //.then(this.uiSegmentSrv.transformToSegments(false));\n       }\n\n \n\n getTableNames() {\n        console.log(\"I am in get Table Names\");\n        console.log(this.target);\n    \treturn  this.datasource.metricFindTables(this.target)\n      .then(this.uiSegmentSrv.transformToSegments(false));\n        }\n\n getWhereFields(){\n\tconsole.log(\"I am in get Table Names\");\n        console.log(self.target);\n\tconsole.log(arguments[0]);\n\t//var a = this.target.whereClauseGroup[parentIndex][index].right;\n    \treturn self.datasource.findWhereFields(self.target,self.parentIndex, self.index, arguments[0], arguments[1]);\n        }\n\n foo(){\n\tconsole.log(\"I am in foo\");\n       \tconsole.log(self.test);\n\t//console.log(index);\n\t//return [\"abcd\",\"azme\",\"aoiq\",\"dnvbv\",\"doie\",\"abwe\",\"aoio\"];\n\treturn self.wName;\n\t}\n\n  saveIndices(parentIndex, index){\n        console.log(\"I am saving indices\");\n        this.parentIndex = parentIndex;\n\tthis.index = index;\n\t}\n\n\n\n  toggleEditorMode() {\n    this.target.rawQuery = !this.target.rawQuery;\n  }\n\n onChangeInternal() {\n\t//this.target.metric_array = ['Select Metric'];\n        //this.target.metricValues_array = ['Select Matric Value'];\n       console.log(this.target);\n\tthis.panelCtrl.refresh();\n     }\n hoverIn(){\n\tthis.hoverEdit = true;\n\t}\n hoverOut(){\n\tthis.hoverEdit = false;\n\t}\n \n}\n\nGenericDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\n\n"]}